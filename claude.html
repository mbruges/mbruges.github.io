<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="/favicon.svg">
    <link rel="stylesheet" href="/style.css">
    <meta charset="utf-8">
    <meta name="description" content="MB ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Portal</title>

    <!--SHARE TAGS-->
    <meta prefix="og: http://ogp.me/ns#" property="og:type" content="website" />
    <meta prefix="og: http://ogp.me/ns#" property="og:title" content="MBruges.com" />
    <meta prefix="og: http://ogp.me/ns#" property="og:description" content=" " />
    <meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://mbruges.com/images/banner-square.png" />
    <meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://mbruges.com/" />


<script>

    const starterText = `<br>
                <p>CLAUDE: <i>Bonjour!</i> I am Claude, a chatbot created by Anthropic, and put onto this webpage by <a style="color:var(--color-darkblue);" href="/about.html" target="_blank">Max Bruges</a>.</p>
                <p>I can do lots of things with text, including reading files and taking on roles. </p>
                <p> Click one of the buttons below, or simply type a question to start.</p>
                <center>
                    <code style="color:white;cursor: pointer;background-color: var(--color-darkblue);padding: 6px;"
                        onclick="document.getElementById('fileInput').click()"> Upload file üìÇ</code>
                    <code style="color:white;cursor: pointer;background-color: var(--color-darkblue);padding: 6px;"
                        onclick="roleplayInput(this)"> Roleplay üé≠</code>
                    <code style="color:white;cursor: pointer;background-color: var(--color-darkblue);padding: 6px;"
                        onclick="document.getElementById('input').value = 'Hi there!'; submitInput()">Say hi üëã</code>
                </center>`

function scrollUp(){
    let monitor = document.getElementById('monitor')
    
    monitor.scrollTo({ top: 0, behavior: 'smooth' })
}

function roleplayInput() {
    document.getElementById('roleplayInput').value = window.prompt(`Enter the details of the role you'd like Claude to perform. Keep instructions concise.`, "A pirate");
    console.log(document.getElementById('roleplayInput').value)
    
}

function APIkeyInput() {
   const dialog = document.getElementById('keyInputDialog')
    let claudeAPI = document.getElementById('apiStore').value 
    let corsAPI = document.getElementById('xCorsKeyStore').value
    if ((claudeAPI.length < 10) || (corsAPI.length < 10)) {
        dialog.showModal()
        return
    } else { dialog.close() 
    localStorage.setItem('apiKey',claudeAPI)
    localStorage.setItem('xCorsKey', corsAPI)
    }
}
window.onload = () => {
    // Retrieve values from cache on load
    document.getElementById('apiStore').value = localStorage.getItem('apiKey')
    document.getElementById('xCorsKeyStore').value = localStorage.getItem('xCorsKey')
    //document.getElementById('fileUploadDialog').close()
    APIkeyInput()

    setTimeout(() => {
         if (document.getElementById('keyInputDialog').show != true) {
            document.getElementById('monitor').innerHTML = starterText;
            notifySound()
        }
    }, 500);

}

    function downloadTxt(elementIDtoDownload) {
        const link = document.createElement("a");
        var content = "" + document.getElementById(elementIDtoDownload).innerHTML + `\n\n Generated on mbruges.com üêà‚Äç‚¨õ`
        content = content.replaceAll('<br>','\n')
        const file = new Blob([content], { type: 'text/plain' });
        link.href = URL.createObjectURL(file);
        let date = new Date()
        date = date.toLocaleDateString("en-GB")
        let fileName = `ClaudeTranscript-${date}.txt`
        link.download = fileName;
        link.click();
        URL.revokeObjectURL(link.href);
    };

function insertText(inputElement,idToChange) {
    let input = inputElement
    let target = document.getElementById(idToChange)
    target.value = input.innerHTML
    submitInput()
}

    function notifySound() {
        var audio = document.getElementById("audio");
        audio.play();
    }

function askClaude() {
    let role = 'Be concise in all your responses. Do not reference this instruction in our conversation.'

    let roleplayInput = document.getElementById('roleplayInput').value
    
    if (roleplayInput) {
        role = `You are a ${roleplayInput}. Respond to all questions in this role. Do not break out of this roleplay for any reason. If asked something you cannot answer, make an excuse in-character. Do not reference the fact you are in a roleplay. Do NOT use any asterisked comments, for example: *in deep voice*.`
    }
    //Building convo history

    let convoHistory = document.getElementById('monitor').innerHTML

    convoHistory = convoHistory.replaceAll(starterText, '')
    
    convoHistory = convoHistory.replaceAll('<br>', '\n') 
    convoHistory = convoHistory.replaceAll('USER', 'Human')
    convoHistory = convoHistory.replaceAll('CLAUDE', 'Assistant')
    convoHistory = convoHistory.replaceAll('<b>', '')
    convoHistory = convoHistory.replaceAll('</b>', '')

     let fileContent = document.getElementById('fileContainer').innerText

     if (fileContent.length > 2) {
        fileContent = `Human: ${role}. In this conversation I will be asking questions about this file:\n FILE START \n ${fileContent} \nFILE END \n\n Assistant: I understand. I will answer questions about this file.`;
    } else { fileContent = `Human: ${role} \n\n Assistant: I understand. I will answer questions in a concise manner and not reference this instruction about being concise.` }

    console.log("history is: "+ convoHistory)
    let api = document.getElementById('apiStore')
    let userQuery = document.getElementById('input').value
    var apiKey = document.getElementById('apiStore').value
    var xCorsKey = document.getElementById('xCorsKeyStore').value
    let proxy = 'https://proxy.cors.sh/'
    let url = proxy + 'http://api.anthropic.com/v1/complete/'; 
    console.log(`FULL INPUT: ${fileContent} ${convoHistory} \n\nHuman: ${userQuery}. \n\nAssistant:`)
    fetch(url, {
           method: 'POST',
        headers: {
            'x-cors-api-key': xCorsKey,
            'X-API-Key': apiKey,
            'Content-Type': 'application/json',

        },
            body: JSON.stringify({
                    prompt: `${fileContent} ${convoHistory} \n\nHuman: ${userQuery} \n\nAssistant:`,
                    model: `claude-instant-v1.1`, 
                    max_tokens_to_sample: 5000, 
                    stop_sequences: ["\n\nHuman:"], 
                    temperature: 1
                })
        }).then(response => {
            return response.json()
        }).then(data => {
            console.log(`FULL INPUT: ${fileContent} ${convoHistory} \n\nHuman: ${userQuery}. \n\nAssistant:`)
            newResponse = data.completion
            
            let monitor = document.getElementById('monitor')
            
            let existingChat = monitor.innerHTML
            existingChat = existingChat.replace('<br><br><i>CLAUDE is typing..</i>.','')

            //Fixing presentation of listed items
            newResponse = newResponse.replaceAll('\n', `<br>`)


            monitor.innerHTML = existingChat + '<br><br>' + 'CLAUDE:' + newResponse

            monitor.scrollTop = monitor.scrollHeight;
            notifySound();

        }).catch(error => {
            console.log('error')
            let monitor = document.getElementById('monitor')
            let existingChat = monitor.innerHTML
            existingChat = existingChat.replace('<br><br><i>CLAUDE is typing..</i>.', '')

            monitor.innerHTML = existingChat + '<br><br>' + 'CLAUDE:' + error
        });
    }

    function uploadFile() {
        const [file] = document.querySelector("input[type=file]").files;
        let fileUrl = URL.createObjectURL(file)
        console.log(fileUrl)
        const content = document.getElementById('fileContainer')
        const reader = new FileReader();
        reader.addEventListener(
            "load",
            () => {
                content.innerText = reader.result;
                localStorage.setItem('fileToRead', content.innerText);
                console.log('file uploaded');
                notificationAlert(`File uploaded successfully: ${document.querySelector("input[type=file]").files.item(0).name}`)
                document.getElementById('querySuggestions').className="show"
            },
            false
        );
        if (file) {
            reader.readAsText(file);
        }
        showname()
    }
    

    // Execute a function when the user presses a key on the keyboard
window.addEventListener("keydown", (event) => {
    let focus = document.activeElement.id
        if (event.keyCode === 13 && focus == 'input') {
          submitInput()  
        }})

    function submitInput() {
        if (document.getElementById('input').value == "") {
            return;
        }
        
        askClaude()
        let target = document.getElementById('input')
        let input = target.value

        let monitor = document.getElementById('monitor')

        let fileContent = document.getElementById('fileContainer').innerText

        let existingChat =  monitor.innerHTML

        let newEntry = input

        monitor.innerHTML = existingChat + '<br><br><b>' + 'USER: ' + input +'</b>'

        monitor.scrollTop = monitor.scrollHeight;

        if (target.value.length !== "") {
            target.value = "";
        }

        setTimeout(() => {
            monitor.innerHTML = monitor.innerHTML + '<br><br><i>CLAUDE is typing..</i>.'
        ;
     monitor.scrollTop = monitor.scrollHeight;
}, 200);

        
    }

    function showname() {
            var name = document.getElementById('fileInput');
            document.getElementById('fileBarDisplay').innerHTML =  'Discussing file: ' + name.files.item(0).name;
            
        };

    function notificationAlert(notificationText) {
            var alertelement = document.getElementById("toastAlert");
            alertelement.innerHTML = notificationText
            alertelement.className = "show";
            setTimeout(function () { alertelement.className = alertelement.className.replace("show", ""); }, 3000);
        }
</script>

    
</head>

<body>
    <style> 
    input:focus,
select:focus,
textarea:focus,
button:focus 
    {outline: none;}

.monitor {
    overflow-x: scroll;
padding:10px;
padding-bottom: 20px;
margin-bottom: 1px;
margin-top:-10px;
background-color:transparent;
max-height:50dvh;
width: 95%;
margin-top:1px;
padding-top: 1px;
height: fit-content;
min-height: 40dvh;
background-color:transparent;
color: var(--color-darkblue);
border-color: var(--color-darkblue);
text-align: left;
display: block;
margin-left: auto;
margin-right: auto;
}
</style>
</body>
    <div id="toastAlert"></div>
    
    <header style="max-height: 8dvh;padding-top: 1%;margin-top: 1px;margin-bottom: 1px;">
        <nav>
            <div class="dropdown">
                <a id="catNav"><img alt="miaow" src="/favicon.svg" height="40" width="40"></a>
                <div class="dropdown-content">
                    <a href="/experiments.html">Experiments</a>
                    <a href="/resources.html">Resources</a>
                    <a href="/blog.html">Blog</a>
                </div>
            </div>
            <i id="fileBarDisplay" style="color:var(--color-darkblue);font-size: 12px;font-family: monospace;"> > Bonjour <a style="color: var(--color-darkblue);" href="https://www.anthropic.com/index/introducing-claude" target="_blank">CLAUDE</a> </i>
            <ul>
                <li><a href="/index.html"> Home </a></li>
            </ul>
        </nav>
    </header>


<dialog id="keyInputDialog" style="text-align: center;">
    <style>
    </style>
        <p style="text-align: center;">
            <label id="keyWarning">Please enter the required API keys:
                <input id="apiStore" placeholder="Anthropic API key" value="" class="" style="margin-top: 5px;background-color: var(--color-darkblue);
height: fit-content;
text-align: center;
color: white;
width: 200px;
margin:1px;
margin-left: auto;
margin-right: auto;
display: block;
font-size: 10px;
font-family: monospace;">
                <input id="xCorsKeyStore" placeholder="CORS.SH API key" value="" class="" style="margin-top: 5px;background-color: var(--color-darkblue);
height: fit-content;
text-align: center;
color: white;
width: 200px;
margin:1px;
margin-left: auto;
margin-right: auto;
display: block;
font-size: 10px;
font-family: monospace;">
            </label>
        </p>
        
            <code onclick="this.parentElement.close();setTimeout(() => {
                APIkeyInput()
            }, 10);"
                style="display: inline;color: white;background-color:var(--color-darkblue);cursor: pointer;border-radius: 1px;padding: 6px;">Save keys</code><br><br>
                <small>(Don't worry, these only get saved to your local browser cache)</small>
</dialog>

<p style="font-size:20px;color:white;display: block;margin-left: auto;margin-right:auto;padding: 0;margin-bottom:-40px;margin-top: 1px;border-radius: 0px;background:transparent;width: 84vw;max-width:590px;color:var(--color-darkblue);display:absolute;text-align: center;height:25px"
    id="scrollUp" onclick="scrollUp()" class="hidden">‚òù</p>

<div style="
padding:20px;
padding-bottom: 10px;
border-radius: var(--border-radius);
background-color:rgb(240, 248, 255);
border-color: var(--color-darkblue);
border-width: 10px;
border: 10px;
margin: 10px;
max-width:600px;
display: block;
margin-left: auto;
margin-right: auto;
width: 85vw;
text-align: center;">



<div id="monitor" class="monitor"  onscroll="document.getElementById('scrollUp').className='show';document.getElementById('options-container').className='show'">
</div>

<hr style="background-color: var(--color-darkblue);height:4px;width: 86%;display: block;margin-left: auto;margin-right: auto;">

<div id="input-container" style="display: block;margin-left: auto;margin-right: auto;text-align: center;width: 80vw;max-width:600px">
    <p style="font-size:16px;margin:-10px;padding:-10px;color:var(--color-darkblue);display: inline;">></p>
    <input  style="border-width:0px; border-color: transparent; border-radius: 0px;max-height:30px;display: inline;margin: 0px; width:490px;width: 80%;color: var(--color-darkblue);font-weight:600;background-color:transparent;margin-top:-3px" type="text" placeholder="Enter your query" id="input">
    <p id="submit"  style="font-size:18px;margin:-10px;padding:-10px;color:var(--color-darkblue);display: inline;font-weight: 1000;cursor: pointer;" onclick="submitInput() ">&#8629;</p>
</div>
</div>
</div>
<div id="querySuggestions"
    style="display: block;margin-left: auto;margin-right: auto;text-align: center;max-width: 90vw" class="hidden">
    <style>
        a i {
            padding:5px;
            cursor:pointer
        }
    </style>
    <a><i onclick="insertText(this,'input')">Summarise this file</i></a>
    <a><i onclick="insertText(this,'input')">How could this be improved?</i></a>
    <a><i onclick="insertText(this,'input')">How many words in the file?</i></a>
</div>
<div id="options-container" style="text-align: center;" class="hidden">

    <code style="color:white;cursor: pointer;background-color: var(--color-darkblue);padding: 6px;" onclick="location.reload()">Reset ‚ö†Ô∏è</code>
    <code style="color:white;cursor: pointer;background-color: var(--color-darkblue);padding: 6px;" onclick="document.getElementById('fileInput').click()"> Upload file üìÇ</code>
    <code style="color:white;cursor: pointer;background-color: var(--color-darkblue);padding: 6px;" onclick="roleplayInput(this)"> Roleplay üé≠</code>
    <code style="color:white;cursor: pointer;background-color: var(--color-darkblue);padding: 6px;margin-top: 4px;"
        onclick="downloadTxt('monitor')"> Get transcript üìù</code>
    <input id="fileInput" class="hidden" type="file" accept=".doc,.xml,.rtf,.txt,.csv,.eml,.odt,.ods"
        onchange="uploadFile(); showname()">
    <span id="roleplayInput" value="" class="hidden"></span>
    <span id="fileContainer" value="" class="hidden"></span>
    
</div>
    <audio id="audio" src="/images/pop.wav" ></audio>

    <footer>
        
        <div style="height:1dvh"></div>
        <p>¬© 2023 - <i> Made by <a href="/about.html" target="_blank">me
                </a> and Agatha</i> üêà‚Äç‚¨õ</p>
        <p><i>Found this interesting? <a href="mailto:hello@mbruges.com?subject=Hello from the Internet"
                    style="font-style: normal;"> Drop me a line üìÆ</a>
        </p>
    </footer>
</body>
</html>